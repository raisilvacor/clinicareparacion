{% extends "admin/base_admin.html" %}

{% block title %}Dashboard - Painel Admin{% endblock %}

{% block content %}
<div class="admin-header">
    <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
    <p>Bem-vindo ao painel administrativo</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-envelope"></i>
        </div>
        <div class="stat-content">
            <h3>{{ stats.total_contatos }}</h3>
            <p>Total de Contatos</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-tools"></i>
        </div>
        <div class="stat-content">
            <h3>{{ stats.total_servicos }}</h3>
            <p>Serviços Cadastrados</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
            <h3>{{ stats.contatos_recentes|length }}</h3>
            <p>Contatos Recentes</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
            <h3>Ativo</h3>
            <p>Sistema Funcionando</p>
        </div>
    </div>
</div>

<div class="admin-section">
    <div class="section-header">
        <h2><i class="fas fa-envelope"></i> Contatos Recentes</h2>
        <a href="{{ url_for('admin_contatos') }}" class="btn btn-secondary">
            Ver Todos
        </a>
    </div>
    
    {% if stats.contatos_recentes %}
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>E-mail</th>
                    <th>Telefone</th>
                    <th>Serviço</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody>
                {% for contato in stats.contatos_recentes %}
                <tr>
                    <td>{{ contato.nome }}</td>
                    <td>{{ contato.email }}</td>
                    <td>{{ contato.telefone }}</td>
                    <td>{{ contato.servico }}</td>
                    <td>{{ contato.data }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-inbox"></i>
        <p>Nenhum contato ainda</p>
    </div>
    {% endif %}
</div>

<div class="admin-section">
    <div class="section-header">
        <h2><i class="fas fa-calendar-check"></i> Notificações de Agendamentos</h2>
        <a href="{{ url_for('admin_agendamentos') }}" class="btn btn-secondary">
            Ver Todos
        </a>
    </div>
    
    {% if stats.agendamentos_recentes %}
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Telefone</th>
                    <th>Data do Agendamento</th>
                    <th>Hora</th>
                    <th>Serviço</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for agendamento in stats.agendamentos_recentes %}
                <tr class="{% if agendamento.status == 'pendente' %}notification-pending{% elif agendamento.status == 'confirmado' %}notification-confirmed{% elif agendamento.status == 'concluido' %}notification-completed{% elif agendamento.status == 'cancelado' %}notification-cancelled{% endif %}">
                    <td><strong>{{ agendamento.nome }}</strong></td>
                    <td>{{ agendamento.telefone }}</td>
                    <td>{{ agendamento.data_agendamento }}</td>
                    <td>{{ agendamento.hora_agendamento }}</td>
                    <td>{{ agendamento.tipo_servico }}</td>
                    <td>
                        <span class="badge badge-{{ agendamento.status }}">
                            {% if agendamento.status == 'pendente' %}
                                Pendente
                            {% elif agendamento.status == 'confirmado' %}
                                Confirmado
                            {% elif agendamento.status == 'concluido' %}
                                Concluído
                            {% elif agendamento.status == 'cancelado' %}
                                Cancelado
                            {% else %}
                                {{ agendamento.status|title }}
                            {% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-calendar-times"></i>
        <p>Nenhum agendamento ainda</p>
    </div>
    {% endif %}
</div>

<div class="admin-section">
    <div class="section-header">
        <h2><i class="fas fa-bolt"></i> Ações Rápidas</h2>
    </div>
    <div class="quick-actions">
        <a href="{{ url_for('admin_contatos') }}" class="action-card">
            <i class="fas fa-envelope"></i>
            <h3>Gerenciar Contatos</h3>
            <p>Visualizar e gerenciar mensagens recebidas</p>
        </a>
        <a href="{{ url_for('admin_servicos') }}" class="action-card">
            <i class="fas fa-tools"></i>
            <h3>Gerenciar Serviços</h3>
            <p>Adicionar, editar ou remover serviços</p>
        </a>
    <a href="{{ url_for('admin_usuarios') }}" class="action-card">
        <i class="fas fa-users-cog"></i>
        <h3>Usuários</h3>
        <p>Gerenciar usuários do painel administrativo</p>
    </a>
        <a href="{{ url_for('admin_clientes') }}" class="action-card">
            <i class="fas fa-users"></i>
            <h3>Gerenciar Clientes</h3>
            <p>Cadastrar e gerenciar clientes</p>
        </a>
        <a href="{{ url_for('add_ordem_servico') }}" class="action-card">
            <i class="fas fa-file-invoice"></i>
            <h3>Emitir Ordem de Serviço</h3>
            <p>Registrar nova ordem de serviço</p>
        </a>
        <a href="{{ url_for('admin_ordens') }}" class="action-card">
            <i class="fas fa-list"></i>
            <h3>Ver Ordens de Serviço</h3>
            <p>Visualizar todas as ordens emitidas</p>
        </a>
        <a href="{{ url_for('admin_financeiro') }}" class="action-card">
            <i class="fas fa-dollar-sign"></i>
            <h3>Financeiro</h3>
            <p>Saldo e valores a receber</p>
        </a>
        <a href="{{ url_for('emitir_comprovante') }}" class="action-card">
            <i class="fas fa-receipt"></i>
            <h3>Emitir Comprovante</h3>
            <p>Gerar comprovante de pagamento</p>
        </a>
        <a href="{{ url_for('admin_comprovantes') }}" class="action-card">
            <i class="fas fa-file-invoice"></i>
            <h3>Comprovantes Emitidos</h3>
            <p>Visualizar comprovantes</p>
        </a>
        <a href="{{ url_for('admin_fidelidade') }}" class="action-card">
            <i class="fas fa-gift"></i>
            <h3>Club Clínica de Reparación</h3>
            <p>Emitir cupons de desconto</p>
        </a>
        <a href="{{ url_for('admin_tecnicos') }}" class="action-card">
            <i class="fas fa-user-cog"></i>
            <h3>Cadastro de Técnicos</h3>
            <p>Gerenciar técnicos da equipe</p>
        </a>
        <a href="{{ url_for('admin_manuais') }}" class="action-card">
            <i class="fas fa-book"></i>
            <h3>Manuais</h3>
            <p>Gerenciar manuais em PDF</p>
        </a>
        <a href="{{ url_for('admin_orcamentos_ar') }}" class="action-card">
            <i class="fas fa-snowflake"></i>
            <h3>Orçamento de Ar-condicionado</h3>
            <p>Gerar orçamentos para instalação e manutenção</p>
        </a>
        <a href="{{ url_for('admin_agendamentos') }}" class="action-card">
            <i class="fas fa-calendar-check"></i>
            <h3>Agendamentos</h3>
            <p>Visualizar e gerenciar agendamentos</p>
        </a>
        <a href="{{ url_for('admin_slides') }}" class="action-card">
            <i class="fas fa-images"></i>
            <h3>Gerenciar Slides</h3>
            <p>Gerenciar slides da página inicial</p>
        </a>
        <a href="{{ url_for('admin_footer') }}" class="action-card">
            <i class="fas fa-edit"></i>
            <h3>Gerenciar Rodapé</h3>
            <p>Editar informações do rodapé do site</p>
        </a>
        <a href="{{ url_for('admin_marcas') }}" class="action-card">
            <i class="fas fa-tags"></i>
            <h3>Gerenciar Marcas</h3>
            <p>Gerenciar principais marcas exibidas</p>
        </a>
        <a href="{{ url_for('admin_milestones') }}" class="action-card">
            <i class="fas fa-trophy"></i>
            <h3>Gerenciar Marcos</h3>
            <p>Gerenciar marcos/milestones exibidos</p>
        </a>
        <a href="{{ url_for('admin_reparos') }}" class="action-card">
            <i class="fas fa-tools"></i>
            <h3>Reparos Realizados</h3>
            <p>Gerenciar galeria de reparos realizados</p>
        </a>
        <a href="{{ url_for('admin_videos') }}" class="action-card">
            <i class="fas fa-video"></i>
            <h3>Vídeos</h3>
            <p>Gerenciar vídeos do YouTube</p>
        </a>
        <a href="{{ url_for('admin_paginas_servicos') }}" class="action-card">
            <i class="fas fa-file-alt"></i>
            <h3>Páginas de Serviços</h3>
            <p>Gerenciar páginas individuais de serviços</p>
        </a>
        <a href="{{ url_for('admin_fornecedores') }}" class="action-card">
            <i class="fas fa-truck"></i>
            <h3>Fornecedores</h3>
            <p>Gerenciar fornecedores cadastrados</p>
        </a>
        <a href="{{ url_for('index') }}" class="action-card" target="_blank">
            <i class="fas fa-external-link-alt"></i>
            <h3>Ver Site</h3>
            <p>Abrir o site em nova aba</p>
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Auto-refresh apenas na página do dashboard a cada 1 minuto (60000ms)
    if (window.location.pathname === '/admin' || window.location.pathname === '/admin/') {
        setInterval(function() {
            // Recarregar a página suavemente
            window.location.reload();
        }, 60000); // 1 minuto = 60000 milissegundos
        
        // Mostrar indicador de atualização automática
        console.log('Dashboard configurado para atualizar automaticamente a cada 1 minuto');
    }
</script>
{% endblock %}

