{% extends "admin/base_admin.html" %}

{% block title %}Dashboard - Panel Admin{% endblock %}

{% block content %}
<div class="admin-header">
    <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
    <p>Bienvenido al panel administrativo</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-envelope"></i>
        </div>
        <div class="stat-content">
            <h3>{{ stats.total_contatos }}</h3>
            <p>Total de Contactos</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-tools"></i>
        </div>
        <div class="stat-content">
            <h3>{{ stats.total_servicos }}</h3>
            <p>Servicios Registrados</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
            <h3>{{ stats.contatos_recentes|length }}</h3>
            <p>Contactos Recientes</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
            <h3>Activo</h3>
            <p>Sistema Funcionando</p>
        </div>
    </div>
</div>

<div class="admin-section">
    <div class="section-header">
        <h2><i class="fas fa-envelope"></i> Contactos Recientes</h2>
        <a href="{{ url_for('admin_contatos') }}" class="btn btn-secondary">
            Ver Todos
        </a>
    </div>
    
    {% if stats.contatos_recentes %}
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>E-mail</th>
                    <th>Teléfono</th>
                    <th>Servicio</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody>
                {% for contato in stats.contatos_recentes %}
                <tr>
                    <td>{{ contato.nome }}</td>
                    <td>{{ contato.email }}</td>
                    <td>{{ contato.telefone }}</td>
                    <td>{{ contato.servico }}</td>
                    <td>{{ contato.data }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-inbox"></i>
        <p>Ningún contacto aún</p>
    </div>
    {% endif %}
</div>

<div class="admin-section">
    <div class="section-header">
        <h2><i class="fas fa-calendar-check"></i> Notificaciones de Agendamientos</h2>
        <a href="{{ url_for('admin_agendamentos') }}" class="btn btn-secondary">
            Ver Todos
        </a>
    </div>
    
    {% if stats.agendamentos_recentes %}
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Teléfono</th>
                    <th>Fecha del Agendamiento</th>
                    <th>Hora</th>
                    <th>Servicio</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                {% for agendamento in stats.agendamentos_recentes %}
                <tr class="{% if agendamento.status == 'pendente' %}notification-pending{% elif agendamento.status == 'confirmado' %}notification-confirmed{% elif agendamento.status == 'concluido' %}notification-completed{% elif agendamento.status == 'cancelado' %}notification-cancelled{% endif %}">
                    <td><strong>{{ agendamento.nome }}</strong></td>
                    <td>{{ agendamento.telefone }}</td>
                    <td>{{ agendamento.data_agendamento }}</td>
                    <td>{{ agendamento.hora_agendamento }}</td>
                    <td>{{ agendamento.tipo_servico }}</td>
                    <td>
                        <span class="badge badge-{{ agendamento.status }}">
                            {% if agendamento.status == 'pendente' %}
                                Pendiente
                            {% elif agendamento.status == 'confirmado' %}
                                Confirmado
                            {% elif agendamento.status == 'concluido' %}
                                Concluido
                            {% elif agendamento.status == 'cancelado' %}
                                Cancelado
                            {% else %}
                                {{ agendamento.status|title }}
                            {% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-calendar-times"></i>
        <p>Ningún agendamiento aún</p>
    </div>
    {% endif %}
</div>

<div class="admin-section">
    <div class="section-header">
        <h2><i class="fas fa-bolt"></i> Acciones Rápidas</h2>
    </div>
    <div class="quick-actions">
        <a href="{{ url_for('admin_contatos') }}" class="action-card">
            <i class="fas fa-envelope"></i>
            <h3>Gestionar Contactos</h3>
            <p>Visualizar y gestionar mensajes recibidos</p>
        </a>
        <a href="{{ url_for('admin_servicos') }}" class="action-card">
            <i class="fas fa-tools"></i>
            <h3>Gestionar Servicios</h3>
            <p>Agregar, editar o eliminar servicios</p>
        </a>
    <a href="{{ url_for('admin_usuarios') }}" class="action-card">
        <i class="fas fa-users-cog"></i>
        <h3>Usuarios</h3>
        <p>Gestionar usuarios del panel administrativo</p>
    </a>
        <a href="{{ url_for('admin_clientes') }}" class="action-card">
            <i class="fas fa-users"></i>
            <h3>Gestionar Clientes</h3>
            <p>Registrar y gestionar clientes</p>
        </a>
        <a href="{{ url_for('add_ordem_servico') }}" class="action-card">
            <i class="fas fa-file-invoice"></i>
            <h3>Emitir Orden de Servicio</h3>
            <p>Registrar nueva orden de servicio</p>
        </a>
        <a href="{{ url_for('admin_ordens') }}" class="action-card">
            <i class="fas fa-list"></i>
            <h3>Ver Órdenes de Servicio</h3>
            <p>Visualizar todas las órdenes emitidas</p>
        </a>
        <a href="{{ url_for('admin_financeiro') }}" class="action-card">
            <i class="fas fa-dollar-sign"></i>
            <h3>Financiero</h3>
            <p>Saldo y valores a recibir</p>
        </a>
        <a href="{{ url_for('emitir_comprovante') }}" class="action-card">
            <i class="fas fa-receipt"></i>
            <h3>Emitir Comprobante</h3>
            <p>Generar comprobante de pago</p>
        </a>
        <a href="{{ url_for('admin_comprovantes') }}" class="action-card">
            <i class="fas fa-file-invoice"></i>
            <h3>Comprobantes Emitidos</h3>
            <p>Visualizar comprobantes</p>
        </a>
        <a href="{{ url_for('admin_fidelidade') }}" class="action-card">
            <i class="fas fa-gift"></i>
            <h3>Club Clínica de Reparación</h3>
            <p>Emitir cupones de descuento</p>
        </a>
        <a href="{{ url_for('admin_tecnicos') }}" class="action-card">
            <i class="fas fa-user-cog"></i>
            <h3>Registro de Técnicos</h3>
            <p>Gestionar técnicos del equipo</p>
        </a>
        <a href="{{ url_for('admin_manuais') }}" class="action-card">
            <i class="fas fa-book"></i>
            <h3>Manuales</h3>
            <p>Gestionar manuales en PDF</p>
        </a>
        <a href="{{ url_for('admin_orcamentos_ar') }}" class="action-card">
            <i class="fas fa-snowflake"></i>
            <h3>Presupuesto de Aire Acondicionado</h3>
            <p>Generar presupuestos para instalación y mantenimiento</p>
        </a>
        <a href="{{ url_for('admin_agendamentos') }}" class="action-card">
            <i class="fas fa-calendar-check"></i>
            <h3>Agendamientos</h3>
            <p>Visualizar y gestionar agendamientos</p>
        </a>
        <a href="{{ url_for('admin_slides') }}" class="action-card">
            <i class="fas fa-images"></i>
            <h3>Gestionar Slides</h3>
            <p>Gestionar slides de la página principal</p>
        </a>
        <a href="{{ url_for('admin_footer') }}" class="action-card">
            <i class="fas fa-edit"></i>
            <h3>Gestionar Pie de Página</h3>
            <p>Editar información del pie de página del sitio</p>
        </a>
        <a href="{{ url_for('admin_marcas') }}" class="action-card">
            <i class="fas fa-tags"></i>
            <h3>Gestionar Marcas</h3>
            <p>Gestionar principales marcas mostradas</p>
        </a>
        <a href="{{ url_for('admin_milestones') }}" class="action-card">
            <i class="fas fa-trophy"></i>
            <h3>Gestionar Hitos</h3>
            <p>Gestionar hitos/milestones mostrados</p>
        </a>
        <a href="{{ url_for('admin_reparos') }}" class="action-card">
            <i class="fas fa-tools"></i>
            <h3>Reparaciones Realizadas</h3>
            <p>Gestionar galería de reparaciones realizadas</p>
        </a>
        <a href="{{ url_for('admin_videos') }}" class="action-card">
            <i class="fas fa-video"></i>
            <h3>Videos</h3>
            <p>Gestionar videos de YouTube</p>
        </a>
        <a href="{{ url_for('admin_paginas_servicos') }}" class="action-card">
            <i class="fas fa-file-alt"></i>
            <h3>Páginas de Servicios</h3>
            <p>Gestionar páginas individuales de servicios</p>
        </a>
        <a href="{{ url_for('admin_fornecedores') }}" class="action-card">
            <i class="fas fa-truck"></i>
            <h3>Proveedores</h3>
            <p>Gestionar proveedores registrados</p>
        </a>
        <a href="{{ url_for('index') }}" class="action-card" target="_blank">
            <i class="fas fa-external-link-alt"></i>
            <h3>Ver Sitio</h3>
            <p>Abrir el sitio en nueva pestaña</p>
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
        // Auto-refresh solo en la página del dashboard cada 1 minuto (60000ms)
        if (window.location.pathname === '/admin' || window.location.pathname === '/admin/') {
            setInterval(function() {
                // Recargar la página suavemente
                window.location.reload();
            }, 60000); // 1 minuto = 60000 milisegundos
            
            // Mostrar indicador de actualización automática
            console.log('Dashboard configurado para actualizar automáticamente cada 1 minuto');
        }
</script>
{% endblock %}

