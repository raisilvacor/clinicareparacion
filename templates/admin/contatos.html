{% extends "admin/base_admin.html" %}

{% block title %}Contactos - Panel Admin{% endblock %}

{% block content %}
<div class="admin-header">
    <h1><i class="fas fa-envelope"></i> Gestionar Contactos</h1>
    <p>Visualice y gestione todos los mensajes recibidos</p>
</div>

{% if contatos %}
<div class="table-responsive">
    <table class="admin-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>E-mail</th>
                <th>Teléfono</th>
                <th>Servicio</th>
                <th>Mensaje</th>
                <th>Fecha</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for contato in contatos %}
            <tr>
                <td>{{ contato.id }}</td>
                <td><strong>{{ contato.nome }}</strong></td>
                <td>{{ contato.email }}</td>
                <td>{{ contato.telefone }}</td>
                <td><span class="badge">{{ contato.servico }}</span></td>
                <td class="message-cell" data-full-message="{{ contato.mensagem }}">{{ contato.mensagem[:50] }}{% if contato.mensagem|length > 50 %}...{% endif %}</td>
                <td>{{ contato.data }}</td>
                <td>
                    <button class="btn-icon" onclick="viewContact({{ contato.id }})" title="Ver detalles">
                        <i class="fas fa-eye"></i>
                    </button>
                    <form method="POST" action="{{ url_for('delete_contato', contato_id=contato.id) }}" style="display: inline;" onsubmit="return confirm('¿Está seguro que desea eliminar este contacto?');">
                        <button type="submit" class="btn-icon btn-danger" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <i class="fas fa-inbox"></i>
    <p>Ningún contacto aún</p>
    <a href="{{ url_for('contato') }}" class="btn btn-primary" target="_blank">Ver página de contacto</a>
</div>
{% endif %}

<!-- Modal para ver detalles del contacto -->
<div id="contactModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Detalles del Contacto</h2>
        <div id="contactDetails"></div>
    </div>
</div>

<script>
function viewContact(id) {
    // Encontrar o contato na tabela
    const rows = document.querySelectorAll('tbody tr');
    let row = null;
    
    for (let r of rows) {
        const firstCell = r.querySelector('td:first-child');
        if (firstCell && firstCell.textContent.trim() == id) {
            row = r;
            break;
        }
    }
    
    if (!row) return;
    
    const cells = row.querySelectorAll('td');
    const nome = cells[1].querySelector('strong') ? cells[1].querySelector('strong').textContent : cells[1].textContent;
    const messageCell = cells[5];
    const fullMessage = messageCell.getAttribute('data-full-message') || messageCell.textContent;
    
    const details = `
        <p><strong>ID:</strong> ${cells[0].textContent.trim()}</p>
        <p><strong>Nombre:</strong> ${nome}</p>
        <p><strong>E-mail:</strong> ${cells[2].textContent.trim()}</p>
        <p><strong>Teléfono:</strong> ${cells[3].textContent.trim()}</p>
        <p><strong>Servicio:</strong> ${cells[4].textContent.trim()}</p>
        <p><strong>Mensaje:</strong><br>${fullMessage}</p>
        <p><strong>Fecha:</strong> ${cells[6].textContent.trim()}</p>
    `;
    
    document.getElementById('contactDetails').innerHTML = details;
    document.getElementById('contactModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('contactModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('contactModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}
</script>
{% endblock %}

